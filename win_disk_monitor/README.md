# RUS #
# Шаблон Zabbix для web сервера IIS #
## Описание файлов #
* template_disk_os_windows.xml - шаблон для сервера Zabbix
* ZabbixDiskMonitor.xml - шаблон для импорта задания в планировщик задач
* scripts.conf - файл конфигурации для Zabbix Agent
## Установка #
Для установки шаблона мониторинга дисковой подсистемы необхожимо выполнить следующие шаги:
1. Скопировать папку scripts в папку Zabbix Agent
1. Скопировать файл scripts.conf в папку с Zabbix Agent
1. Исправить параметры пользовательских элементов данных в файле "scripts.conf", указав корректные пути к скриптам и кэшу
1. Исправить пути к файлу конфигурации скрипта и папке кэша в файлах discovery.ps1 и param.ps1
1. Импортировать шаблон для планировщика задач Windows ZabbixDiskMonitor.xml
1. Включить мониторинг дисков в файле "config/physical_disk_monitor_param.json"
## Настройка #
По умолчанию, скрипт выключает все параметры мониторинга дисковой подсистемы. Мониторинг включается отдельно для каждого диска и его параметра. Что бы включить мониторинг всех параметров диска "С", необходимо вписать в параметр 
"Enable" значение "True", который идет следом за параметром "NameDisk": "C".
Для того, что бы выключить какой-либо параметр для конкретного диска
## Описание работы #
### Автообнаружение #
Скрипт discovery.ps1, отвечает за обнаружения всех параметров мониторинга всех дисков. Включая все разделы и физические диски. Он же создает файл конфигурации physical_disk_monitor_param.json, в котором описано какие диски и их 
параметры мониторить. Этот файл запускается при событии автообнаружения, которое иницирует Zabbix сервер, возвращая ему JSON ответ. При первом запуске, скрип создат файл конфигурации в папке scripts/config. Начальный конфиг файла 
создается с параметрами, которые выключают опрос счетчиков производительности. Т.е. по умолчанию шаблон не мониторит ничего.
### Мониторинг дисков #
Мониторинг параметров диска, производиться путем опроса счетчиков производительности. Так как опрос одного счетчика занимает не менее 1с, то для опроса 21-го параметра для одного диска, скрип будет выполняться минимум 22с. Что бы 
сократить время выполнения запросов, которые генерирует Zabbix Server, используется хэш. Скрипт param.ps1 выполняется по расписанию с помощью планировщика задач, он опрашивает лишь те диски и параметры, которые включены в файле 
конфигурации, генерирую хэш. Zabbix agent, для обновления элементов данных, использует хэш, размещенный в папке "cache". Такой подход обеспечивает максимальную производительность шаблона мониторинга дисковой подсистемы.
Время выполнения скрипта напрямую зависит от количества параметров и дисков, подлежащих мониторингу. Чем больше диско и параметров, тем долше выполняется срикп. Что бы контролировать время выполнения скрипта мониторинга и регулировать 
частоту его запуска с помощью планировщика, в шаблоне есть отдельный элемент данных "Time exec script monitor". Необходимо следить за тем, что бы время его выполнения не привышало частоту его запуска. т.е. Если скрипт стабильно 
исполняется менее чем за 60с, то запускать скрипт можно не реже чем один раз в минуту. Если время выполнения скрипта более 60 секунд, необходимо исправить расписание планировщикаб что бы скрипт выполнялся реже.


#### Версии #
* Zabbix 3.2
* Microsoft Windows Server 2012 R2 Standard
* IIS 6.2
* Windows PowerShell 4.0

#EN US#
# Zabbix Template for IIS #
#### Versions #
* Zabbix 3.2
* Microsoft Windows Server 2012 R2 Standard
* IIS 6.2
* Windows PowerShell 4.0

